using System;
using System.IO;
using System.Linq;
using System.Text.RegularExpressions;
using System.Collections.Concurrent;
using System.Collections.Generic;
using System.Collections.Frozen;
using System.Threading.Tasks;
using System.Diagnostics;

const string INPUT1 = @"...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....";

const string INPUT2 = @".....................#..........#......#............#........................................#..............................................
#.........................#...................................#...................#.........................................................
......................................................................#......#...................................#..........#...............
........................................................................................................................................#...
......#............................#.......................#................................................................................
........................#......................#.........................................................#..................................
.............#................#.....................#................................#.................................#....................
...............................................................................................................#............................
..........................................#........................#...............................................................#........
#...............................................................................#...............#..................#......#.................
.........#................................................................#..............#............#.....................................
...................................................#........................................................................................
.....#.............#............................................#.........................................#...................#.............
.......................................................................................................................#....................
..........................................#.............#......................................#.......................................#....
..........#..........................#........................................................................#.............................
..........................................................................#..........................#......................................
...#..................#..........................#......................................#...................................................
.................#..........................#....................................................#...........................#.......#......
............................#.................................#.......#...........................................#.........................
.......#.........................................................................#..........................................................
...........................................................................#..........................#...................................#.
...............................................................................................#...............#..................#.........
............................................................................................................................................
.............#...........................................#.....#........................#................................#..................
.#..................................................#...................#...........................#.......#...............................
............................#................................................................#..........................................#...
.........#....................................#.............#....................................................#..........................
...................#...................#............................#.............................................................#.........
.........................#..................................................................................................................
...................................................................................#........................................#...............
.......#...........................................#.........................................................#..............................
..........................................#......................#............#.............#........................................#......
................................#.......................................................................#...................................
....#.................................#..................................................................................................#..
............................#...............................................................................................................
..............#........#.............................................#......................................................................
....................................................#.......#...........................................................#...................
..........#........#...............................................................#..............#.........................................
..............................................#..............................................#..................#...........................
.................................#............................................#...........................#................................#
..#...................................#.............................................................................#................#......
............#.......................................................................................#........................#..............
.................................................#..............#......#.............#......................................................
................................................................................#...........................................................
...........................................#..........#....................................................#......#.........................
........................#.......................................................................................................#...........
..................#...............#...........................................................#.............................................
.....#.....#.......................................#..........................................................#.........................#...
#......................................................................#..................#.........#.......................................
......................#..............#...........................#..........................................................................
..............................#...............#.............#..............................................#.......#........#...............
............................................................................................................................................
..............#.....................................#..................................#...............#..........................#.........
..#........................#................................................................................................................
................................................................#...........................#..................#............................
.........#...................................................................#..........................................#............#......
..................#........................#................................................................................................
.................................................#.......................#......................#.........................................#.
............................................................................................................................................
..#...........#.............#....................................................................................#..........................
.....................#..............................................#.......................................................................
.....................................#.............................................#......#.................#...........................#...
..........................................#..........#..................................................................#...................
........................#........#...............................#.................................#...........................#............
........#.................................................#.................................................................................
............................................................................................................................................
#.................#...................#..........#..................#.....#........................................................#........
............#.................................................................................................#.............................
..........................#.........................................................#.......................................................
...................................#.....................................................#..........#.......................................
............................................#..................#..................................................#.........................
..............#..........................................#............#........................#..........................................#.
......#.................#........................................................#..........................................................
...................................................#.......................................#..................................#.....#.......
.........................................#..................................................................................................
.....................#.........................#......................................#............#.....................#..................
............................#......#.........................................#......................................#.......................
............................................................................................................................................
...........#......................................#.................#.............#.........................................................
.............................................#..........#..................................#..................#.............................
..................#........................................................#............................#.............#.....................
............................................................................................................................................
............................................................................................................................................
.............#.......................#......................................................................................................
....................#......................#................................................#...............................................
........................................................#.............#........#.....................................................#......
.....#........................................................#..........................................#......................#...........
..........#..............#......#.........................................#......................................#..........................
..................................................#.........................................................................................
.#...................................................................................................#.......#.........#.................#..
.....................................#.........................................................#............................................
......................#......................#..................................#...........................................................
..........................................................................................................................#...........#.....
.................................#.........................#........................................................#.......................
...........#....................................................#.......................#..................#....................#..........#
...................................................#.................#......................................................................
#..........................#........#.....................................#.........#..........#............................................
...........................................................................................................................#...........#....
....................#.........................#.................................#...........................................................
.......#............................................................................................#.....#.................................
......................................................#........#........#....................#............................................#.
........................................#...................................................................................................
.........................#.....#...........................#.......#...............#..........................#.............................
.............#..............................#.........................................................................#.....................
.................................................#......................................#...................................................
................................................................................................#...........................................
....................#.............................................................................................................#.........
#.........................................#...................#..............................................#..............................
....................................................................#...........#....................................#......................
..............#........#.......................#......#.....................................#.........#.....................................
.....................................#....................................#...............................................................#.
...................#.......................................#..........................#......................................#..............
........#.....................#.............................................................................................................
.........................#..............................................................................#..........#........................
#...............................................................#.................#.........................................................
.......................................#.............................#............................#.......................#...........#.....
.................................................#..........................................................#..............................#
.........................................................#....................................................................#.............
.........................................................................................#..................................................
......#.........#......#...............................................................................#....................................
...........................................#........................#................#......................................................
............................#.......#.................................................................................#.............#.......
...................#.............................................................................................#..........#...............
...............................................#.........#.........................................#......#.................................
...............................................................................#................................................#...........
...............................................................#....................#........#........................................#.....
.........#........................................#.........................................................................................
.......................................................#................#..........................................#.........#..............
...................................#....................................................#..............#....................................
.................#......................#.....#.............................................................................................
#.......................#.......................................................#..........................................................#
...............................................................................................................#..........#.................
....................#.............................#...........................................#.....#................#......................
.....................................#.....................#.............#............................................................#.....
....#.........#....................................................#........................................................................
.................................................................................#..........................................................
............................#.........................................................................#.....................................
........#............................................#.....................................#.................................#..............
......................#................#...............................#......#............................#................................";

const string INPUT3 = @"";

void Run(string input, int multiplier)
{
    using var sr = new StringReader(input);
    string line;

    var lines = new List<string>();
    var emptyRows = new List<int>();
    var row = 0;
    while ((line = sr.ReadLine()) != null)
    {
        lines.Add(line);

        // expand Y
        if(line.All(ch => ch == '.')) emptyRows.Add(row);

        row++;
    }

    var galaxies = new List<Point>();
    var emptyColumns = new List<int>();

    for (var x = 0; x < lines[0].Length; x++)
    {
        var galaxyFound = false;
        for (var y = 0; y < lines.Count; y++)
        {
            if (lines[y][x] != '.')
            {
                galaxyFound = true;
                galaxies.Add(new Point(x, y));
            }
        }

        if (!galaxyFound) emptyColumns.Add(x);
    }

    // calculate distances
    var distance = 0L;
    for (var i = 0; i < galaxies.Count - 1; i++)
    {
        var galaxy1 = galaxies[i];
        for (var j = i; j < galaxies.Count; j++)
        {
            var galaxy2 = galaxies[j];

            var rows = emptyRows.Where(r => galaxy1.Y > galaxy2.Y ? r > galaxy2.Y && r < galaxy1.Y : r > galaxy1.Y && r < galaxy2.Y).Count();
            var cols = emptyColumns.Where(r => galaxy1.X > galaxy2.X ? r > galaxy2.X && r < galaxy1.X : r > galaxy1.X && r < galaxy2.X).Count();

            var d = Math.Abs(galaxy1.X - galaxy2.X) + Math.Abs(galaxy1.Y - galaxy2.Y) + rows * multiplier + cols * multiplier;

            if (multiplier > 1) d -= (rows + cols);

            distance += d;
        }
    }

    Console.WriteLine($"Combined distance: {distance}");
}


Console.WriteLine("Part 1:");
Run(INPUT1, 1);
Run(INPUT2, 1);

Console.WriteLine("Part 2:");
Run(INPUT1, 10);
Run(INPUT1, 100);
Run(INPUT2, 1000000);

class Point : IEquatable<Point>
{
    public int X;

    public int Y;

    public Point(int x, int y)
    {
        this.X = x;
        this.Y = y;
    }

    public bool Equals(Point other)
    {
        if (other == null)
            return false;

        return this.X == other.X && this.Y == other.Y;
    }

    public override bool Equals(Object obj)
    {
        if (obj == null)
            return false;

        if (obj is Point point) return Equals(point);

        return false;
    }

    public override int GetHashCode()
    {
        return HashCode.Combine(this.X, this.Y);
    }

    public static bool operator ==(Point p1, Point p2)
    {
        if (((object)p1) == null || ((object)p2) == null)
            return Object.Equals(p1, p2);

        return p1.Equals(p2);
    }

    public static bool operator !=(Point p1, Point p2)
    {
        if (((object)p1) == null || ((object)p2) == null)
            return !Object.Equals(p1, p2);

        return !(p1.Equals(p2));
    }
}